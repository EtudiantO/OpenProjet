import os
import csv
from bs4 import BeautifulSoup
import requests
import shutil

#path = os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/Fichiers/fille.csv:")
#result = os.listdir(p"ath)"

#def get_all_categories():
   # book_cat = "https://books.toscrape.com/catalogue/category/books_1/index.html"
   # reponse = requests.get(book_cat)
   # soup = BeautifulSoup(reponse.content.decode("utf-8", "ignore"), features="html.parser")

#with open( os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/Fichiers/fille.csv"), 'w', newline='') as fs:
        #writer = csv.writer(fs)
       # writer.writerows("005, ORANGE,INERTMILAN,38")
def get_all_categories():
  # book = ["https://books.toscrape.com/catalogue/category/books_1/index.html","https://books.toscrape.com/catalogue/category/books_1/page-2.html","https://books.toscrape.com/catalogue/category/books_1/page-3.html","https://books.toscrape.com/catalogue/category/books_1/page-4.html",
     #       "https://books.toscrape.com/catalogue/category/books_1/page-5.html","https://books.toscrape.com/catalogue/category/books_1/page-6.html","https://books.toscrape.com/catalogue/category/books_1/page-7.html","https://books.toscrape.com/catalogue/category/books_1/page-8.html","https://books.toscrape.com/catalogue/category/books_1/page-9.html","https://books.toscrape.com/catalogue/category/books_1/page-10.html","https://books.toscrape.com/catalogue/category/books_1/page-11.html","https://books.toscrape.com/catalogue/category/books_1/page-12.html","https://books.toscrape.com/catalogue/category/books_1/page-13.html","https://books.toscrape.com/catalogue/category/books_1/page-14.html","https://books.toscrape.com/catalogue/category/books_1/page-15.html","https://books.toscrape.com/catalogue/category/books_1/page-16.html","https://books.toscrape.com/catalogue/category/books_1/page-17.html","https://books.toscrape.com/catalogue/category/books_1/page-18.html","https://books.toscrape.com/catalogue/category/books_1/page-19.html","https://books.toscrape.com/catalogue/category/books/short-stories_45/index.html"
       #     "https://books.toscrape.com/catalogue/category/books_1/page-20.html","https://books.toscrape.com/catalogue/category/books_1/page-21.html","https://books.toscrape.com/catalogue/category/books_1/page-22.html","https://books.toscrape.com/catalogue/category/books_1/page-23.html","https://books.toscrape.com/catalogue/category/books_1/page-24.html","https://books.toscrape.com/catalogue/category/books_1/page-25.html","https://books.toscrape.com/catalogue/category/books_1/page-26.html","https://books.toscrape.com/catalogue/category/books_1/page-27.html","https://books.toscrape.com/catalogue/category/books_1/page-28.html","https://books.toscrape.com/catalogue/category/books_1/page-29.html","https://books.toscrape.com/catalogue/category/books_1/page-30.html","https://books.toscrape.com/catalogue/category/books_1/page-31.html","https://books.toscrape.com/catalogue/category/books_1/page-32.html","https://books.toscrape.com/catalogue/category/books_1/page-33.html","https://books.toscrape.com/catalogue/category/books_1/page-34.html","https://books.toscrape.com/catalogue/category/books_1/page-35.html",
        #   "https://books.toscrape.com/catalogue/category/books_1/page-36.html","https://books.toscrape.com/catalogue/category/books_1/page-37.html","https://books.toscrape.com/catalogue/category/books_1/page-38.html","https://books.toscrape.com/catalogue/category/books_1/page-39.html","https://books.toscrape.com/catalogue/category/books_1/page-40.html","https://books.toscrape.com/catalogue/category/books_1/page-41.html","https://books.toscrape.com/catalogue/category/books_1/page-42.html","https://books.toscrape.com/catalogue/category/books_1/page-43.html","https://books.toscrape.com/catalogue/category/books_1/page-44.html","https://books.toscrape.com/catalogue/category/books_1/page-45.html","https://books.toscrape.com/catalogue/category/books_1/page-46.html","https://books.toscrape.com/catalogue/category/books_1/page-47.html","https://books.toscrape.com/catalogue/category/books_1/page-48.html","https://books.toscrape.com/catalogue/category/books_1/page-49.html","https://books.toscrape.com/catalogue/category/books_1/page-50.html"]
    homepage="https://books.toscrape.com"

    reponse = requests.get(homepage)
    soup = BeautifulSoup(reponse.content.decode("utf-8", "ignore"), features="html.parser")
    categories=soup.find('div',{'class':'side_categories'}).findAll('a')
    #print(categories)
    listcat=[]
    for category in categories:
        dic={}
        dic[category.text.strip()]=category['href']

       # for x,y in dic.items():
          #  print(x,":",y)
        listcat+=[dic]
   # print(listcat)

    with open(os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/Fichiers/fille.csv"), 'w', newline='') as fs:
             writer = csv.writer(fs, delimiter=';', lineterminator='\\n')
             #print(elst)
             writer.writerow(listcat)

    with open(os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/Fichiers/fille.csv"), newline='', encoding='utf-8') as fs:
                reader = csv.reader(fs)
              #  for row in reader:
                  #  print(row)

get_all_categories()

def get_all_books():

   homepage = "https://books.toscrape.com/"
   reponse = requests.get(homepage)
   soup = BeautifulSoup(reponse.content.decode("utf-8", "ignore"), features="html.parser")

   categories = soup.find('div', {'class': 'side_categories'}).findAll('a')
   # print(categories)
   listcat = []
   for category in categories:
       dic = {}
       dic[category.text.strip()] =homepage+category['href']
       #print(dic)
       for i,y in dic.items():

           # b="http://books.toscrape.com/"+y
           # print(y)

            reponse1 = requests.get(y)
            soup = BeautifulSoup(reponse1.content.decode("utf-8", "ignore"), features="html.parser")

            if reponse.ok:

                list_book = soup.find_all("img")  # afficher tout les liens images de livres
                list = []
                for image in list_book:
                    list.append(image['src'])

                    with open(os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/LesCategories/"+i+".csv"), 'w',   newline='') as ffichier:
                                writer =csv.writer(ffichier, delimiter=';', lineterminator='\\n')
                                writer.writerow(list)
                nbr_page=soup.find("li",{"class": "current"})
                if nbr_page:
                  for k in range(2,int(nbr_page.text.strip()[-1])+ 1):
                      toto=y.split("/")
                      toto[-1]="page-"+str(k)+".html"
                      url="/".join(toto)
                      kb =requests.get(url)
                      soup = BeautifulSoup(kb.content.decode("utf-8", "ignore"), features="html.parser")
                      list_book = soup.find_all("img")
                      for image in list_book:
                          list.append(image['src'])


get_all_books()

def get_product_page(url_book):

    reponse = requests.get(url_book)
    soup3 = BeautifulSoup(reponse.content.decode("utf-8", "ignore"), features="html.parser")

    if reponse.ok:
        ret={}
        ret['titre']=soup3.find('h1').text
        ret['description'] = soup3.find('meta', {'name': 'description'})['content']
        information = soup3.find_all('td')
        ret['upc_livre'] = information[0].text
        ret['prix_ht'] = information[2].text
        ret['prix_ttc']=information[3].text
        ret['stock']=information[5].text
       # for x,y in ret.items():
           # print(x,":",y)

get_product_page("https://books.toscrape.com/catalogue/its-only-the-himalayas_981/index.html")

def get_book_categorie():
    homepage = "https://books.toscrape.com/"
    reponse=requests.get(homepage)
    soup=BeautifulSoup(reponse.content.decode("utf-8", "ignore"),features="html.parser")
    categories=soup.find('div', {'class':'side_categories'}).findAll('a')

    for category in categories[1:]:


        i=category.text.strip()
        y=homepage+category['href']

        reponse=requests.get(y)
        soup=BeautifulSoup(reponse.content.decode("utf-8", "ignore"),features="html.parser")
        books=soup.find('section').findAll('a')
        l=[]
        for b in books:
            print(b)
            if b['href'] not in l:
                l.append(b['href'])
                #print(l)
        with open(os.path.abspath("C:/Users/Idrissa TOUNKARA/PycharmProjects/testProjet/Books/"+i+".csv"), 'w',newline='') as ffichier:
                    writer = csv.writer(ffichier, delimiter=';', lineterminator='\\n')
                    writer.writerow(l)
get_book_categorie()


